<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>পছন্দের শপ - ডিজিটাল প্রোডাক্ট শপ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Dark Theme Colors (Default) */
            --color-bg: #121212;
            --color-text: #f3f4f6;
            --color-text-muted: #9ca3af;
            --color-surface: #1f1f1f;
            --color-glass-bg: rgba(31, 31, 31, 0.7);
            --color-glass-border: rgba(255, 255, 255, 0.1);
            --color-input-bg: #374151;
            --color-primary: #f59e0b;
            --color-primary-hover: #d97706;
            --color-primary-text: #121212;
            --color-primary-text-alt: #ffffff;
        }

        .light-mode {
            /* Light Theme Colors */
            --color-bg: #f9fafb;
            --color-text: #111827;
            --color-text-muted: #6b7281;
            --color-surface: #ffffff;
            --color-glass-bg: rgba(255, 255, 255, 0.7);
            --color-glass-border: rgba(0, 0, 0, 0.1);
            --color-input-bg: #e5e7eb;
            --color-primary: #f59e0b;
            --color-primary-hover: #d97706;
            --color-primary-text: #ffffff;
            --color-primary-text-alt: #121212;
        }

        html { scroll-behavior: smooth; }
        body {
            font-family: 'Hind Siliguri', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
            transition: background-color 0.3s, color 0.3s;
        }
        .glass-effect {
            background: var(--color-glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--color-glass-border);
        }
        .hero-gradient {
            background: radial-gradient(circle at 50% 0%, rgba(250, 204, 21, 0.1), transparent 60%);
        }
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transform: translateY(150%);
            transition: transform 0.5s ease-in-out;
            z-index: 1050;
        }
        .notification.show { transform: translateY(0); }
        .modal-overlay, .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.active, .modal.active {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background: var(--color-surface);
            padding: 2rem;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            transform: scale(0.9);
            transition: transform 0.3s;
            position: relative;
        }
        .modal-overlay.active .modal-content, .modal.active .modal-content { transform: scale(1); }
        #cart-modal .modal-content {
            margin-left: auto;
            margin-right: 0;
            height: 100%;
            border-radius: 12px 0 0 12px;
            transform: translateX(100%);
        }
        #cart-modal.active .modal-content {
             transform: translateX(0);
        }
        .category-btn.active {
            background-color: var(--color-primary);
            color: var(--color-primary-text);
        }
        .favorite-btn.favorited { color: #ef4444; }
        .dashboard-nav-item.active, .sidebar-item.active {
             background-color: var(--color-primary-hover); color: white;
        }
        .cart-item-checkbox {
            accent-color: #f59e0b;
        }
        .star-rating .star {
            color: #4b5563; /* gray-600 */
            cursor: pointer;
            transition: color 0.2s;
        }
        .star-rating .star:hover,
        .star-rating .star.selected {
            color: var(--color-primary);
        }

        /* Color variable applications */
        .text-gray-300, .text-gray-400 { color: var(--color-text-muted); }
        h1, h2, h3, h4, h5, h6, .text-white { color: var(--color-text); }
        .bg-gray-800, input.bg-gray-800, textarea.bg-gray-800, select.bg-gray-800 { 
            background-color: var(--color-input-bg);
            color: var(--color-text);
        }
        .bg-yellow-500 {
            background-color: var(--color-primary);
            color: var(--color-primary-text);
        }
        .text-yellow-500, .border-yellow-500 {
            color: var(--color-primary);
            border-color: var(--color-primary);
        }
        .hover\:bg-yellow-500:hover {
            background-color: var(--color-primary);
            color: var(--color-primary-text-alt) !important;
        }
         .hover\:bg-yellow-600:hover {
            background-color: var(--color-primary-hover);
        }
        .text-yellow-400 { color: var(--color-primary); }

        /* Slider Styles */
        .slider-container {
            position: relative;
            width: 100%;
            height: 60vh;
            overflow: hidden;
        }
        .slide {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
        .slide.active { opacity: 1; }
        .slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .slide-content {
            position: absolute;
            bottom: 10%;
            left: 5%;
            color: white;
            background: rgba(0,0,0,0.5);
            padding: 20px;
            border-radius: 8px;
            max-width: 50%;
        }
        .slider-nav {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        .slider-nav button {
            background: rgba(255,255,255,0.3);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            cursor: pointer;
        }
         /* Admin Panel Styles */
        .stat-card { background-color: #2d3748; }
        .table-auto th, .table-auto td { white-space: nowrap; }
    </style>
</head>
<body class="flex h-screen">

    <!-- This container holds both customer and admin views -->
    <div id="app-container" class="w-full h-full">

        <!-- Header Section (Customer) -->
        <header id="customer-header" class="glass-effect sticky top-0 z-50">
            <nav class="container mx-auto px-4 lg:px-6 py-3 flex justify-between items-center">
                <h1 class="text-xl md:text-2xl font-bold" data-lang-key="site_title">পছন্দের শপ</h1>
                <div class="hidden lg:flex items-center space-x-6">
                    <a href="#" data-action="showHome" class="hover:text-yellow-500 transition" data-lang-key="nav_home">হোম</a>
                    <a href="#products" class="hover:text-yellow-500 transition" data-lang-key="nav_products">প্রোডাক্টস</a>
                    <a href="#" data-action="showSellProduct" class="hover:text-yellow-500 transition" data-lang-key="nav_sell">পণ্য সেল করুন</a>
                    <a href="#" data-action="showDashboard" class="hover:text-yellow-500 transition" data-lang-key="nav_account">আমার অ্যাকাউন্ট</a>
                </div>
                <div class="flex items-center gap-4">
                    <div class="relative hidden md:block">
                        <input type="text" id="search-bar" data-lang-key="search_placeholder" placeholder="প্রোডাক্ট খুঁজুন..." class="bg-gray-800 placeholder-gray-400 rounded-full py-2 pl-10 pr-4 focus:outline-none focus:ring-2 focus:ring-yellow-500 w-full">
                        <svg class="w-5 h-5 text-gray-400 absolute top-1/2 left-3 -translate-y-1/2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z" /></svg>
                    </div>
                    <!-- Language Selector -->
                    <div class="flex items-center gap-1 glass-effect p-1 rounded-full">
                        <button id="lang-bn" data-action="setLang" data-lang="bn" class="px-2 py-1 text-sm rounded-full bg-yellow-500 text-black">বাং</button>
                        <button id="lang-en" data-action="setLang" data-lang="en" class="px-2 py-1 text-sm rounded-full">Eng</button>
                    </div>
                    <!-- Theme Toggle Button -->
                    <button data-action="toggleTheme" id="theme-toggle-btn" class="hover:text-yellow-500 transition">
                        <svg id="moon-icon" class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.72 9.72 0 0 1 18 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 0 0 3 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 0 0 9.002-5.998Z" />
                        </svg>
                        <svg id="sun-icon" class="w-6 h-6 hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0Z" />
                        </svg>
                    </button>
                    <button data-action="showFavorites" class="relative hover:text-yellow-500 transition">
                        <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" /></svg>
                        <span id="favorite-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                    </button>
                    <button data-action="openModal" data-modal-id="cart-modal" class="relative hover:text-yellow-500 transition">
                        <svg class="h-6 w-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 0 0-3 3h15.75m-12.75-3h11.218c.51 0 .962-.343 1.087-.835l1.823-6.814a.75.75 0 0 0-.693-.941H5.617l-.755-2.818A.75.75 0 0 0 3.86 3H2.25M8 21a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Zm10.5 0a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0Z" /></svg>
                        <span id="cart-count" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                    </button>
                    <button id="auth-btn" data-action="authAction" class="bg-yellow-500 hover:bg-yellow-600 font-bold py-2 px-4 rounded-lg transition duration-300 text-sm" data-lang-key="login_btn">লগইন</button>
                </div>
            </nav>
        </header>

        <!-- Main Content (Customer) -->
        <div id="main-content">
            <!-- Slider Section -->
            <section id="slider" class="slider-container">
                <!-- Slides will be dynamically generated here -->
                <div class="slider-nav">
                    <button data-action="prevSlide">&lt;</button>
                    <button data-action="nextSlide">&gt;</button>
                </div>
            </section>

            <!-- Hero Section -->
            <main class="hero-gradient">
                <section class="container mx-auto px-6 py-24 text-center">
                    <h2 class="text-4xl md:text-6xl font-extrabold mb-4 leading-tight" data-lang-key="hero_title">আপনার প্রয়োজনীয় সকল ডিজিটাল প্রোডাক্টস</h2>
                    <p class="text-lg max-w-2xl mx-auto mb-8" data-lang-key="hero_subtitle">ওয়েব টেমপ্লেট, গ্রাফিক্স ডিজাইন, সফটওয়্যার এবং আরও অনেক কিছু, সবই এক জায়গায়।</p>
                    <a href="#products" class="bg-yellow-500 hover:bg-yellow-600 font-bold py-3 px-8 rounded-lg text-lg transition duration-300" data-lang-key="hero_button">প্রোডাক্ট দেখুন</a>
                </section>
            </main>

            <!-- Products Section -->
            <section id="products" class="py-20">
                <div class="container mx-auto px-6">
                    <h3 class="text-3xl font-bold text-center mb-4" data-lang-key="products_title">আমাদের সেরা প্রোডাক্টস</h3>
                    <div id="category-filters" class="flex justify-center flex-wrap gap-2 md:gap-4 mb-12"></div>
                    <div id="product-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
                        <!-- Loading Indicator -->
                        <div id="loading-indicator" class="col-span-full text-center py-10">
                            <p class="text-lg" data-lang-key="loading_text">লোড হচ্ছে...</p>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- User Dashboard Section (Customer) -->
        <section id="dashboard" class="hidden py-20">
            <div class="container mx-auto px-6">
                <h2 class="text-3xl font-bold mb-8" data-lang-key="dashboard_title">আমার অ্যাকাউন্ট ড্যাশবোর্ড</h2>
                <div class="flex flex-col md:flex-row gap-8">
                    <!-- Dashboard Navigation -->
                    <div class="w-full md:w-1/4 glass-effect p-4 rounded-lg self-start">
                        <nav id="dashboard-nav" class="flex flex-col space-y-2">
                            <button data-action="switchDashboardTab" data-target="my-orders" class="text-left p-3 rounded-md hover:bg-gray-700 transition dashboard-nav-item active" data-lang-key="dashboard_nav_orders">আমার অর্ডার</button>
                            <button data-action="switchDashboardTab" data-target="my-favorites" class="text-left p-3 rounded-md hover:bg-gray-700 transition dashboard-nav-item" data-lang-key="dashboard_nav_favorites">ফেভারিট পণ্য</button>
                            <button data-action="switchDashboardTab" data-target="upload-product" class="text-left p-3 rounded-md hover:bg-gray-700 transition dashboard-nav-item" data-lang-key="dashboard_nav_upload">আপনার পণ্য আপলোড করুন</button>
                            <button data-action="switchDashboardTab" data-target="settings" class="text-left p-3 rounded-md hover:bg-gray-700 transition dashboard-nav-item" data-lang-key="dashboard_nav_settings">সেটিংস</button>
                        </nav>
                    </div>
                    <!-- Dashboard Content -->
                    <div class="w-full md:w-3/4">
                        <div id="my-orders" class="dashboard-content">
                            <h3 class="text-2xl font-semibold mb-4" data-lang-key="orders_title">অর্ডার হিস্টোরি</h3>
                            <div class="glass-effect p-6 rounded-lg" id="orders-list">
                                <!-- Orders will be rendered here -->
                            </div>
                        </div>
                        <div id="my-favorites" class="dashboard-content hidden">
                             <h3 class="text-2xl font-semibold mb-4" data-lang-key="favorites_title">আপনার ফেভারিট পণ্য</h3>
                             <div id="favorites-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    <!-- Favorite items will be rendered here -->
                             </div>
                        </div>
                        <div id="upload-product" class="dashboard-content hidden">
                            <h3 class="text-2xl font-semibold mb-4" data-lang-key="upload_title">নতুন পণ্য যোগ করুন</h3>
                            <div class="glass-effect p-6 rounded-lg">
                                <form id="upload-form" class="space-y-4">
                                    <input id="upload-name" type="text" placeholder="পণ্যের নাম" class="w-full bg-gray-800 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" required>
                                    <textarea id="upload-desc" placeholder="পণ্যের বিবরণ" rows="4" class="w-full bg-gray-800 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"></textarea>
                                    <input id="upload-price" type="number" placeholder="পণ্যের মূল্য (৳)" class="w-full bg-gray-800 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" required>
                                    <input id="upload-category" type="text" placeholder="ক্যাটেগরি (যেমন: Web Templates)" class="w-full bg-gray-800 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" required>
                                    <input id="upload-image" type="text" placeholder="পণ্যের ছবির URL" class="w-full bg-gray-800 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" required>
                                    <button type="submit" class="w-full bg-yellow-500 hover:bg-yellow-600 font-bold py-3 px-4 rounded-lg transition duration-300" data-lang-key="upload_button">পণ্য আপলোড করুন</button>
                                </form>
                            </div>
                        </div>
                         <div id="settings" class="dashboard-content hidden">
                             <h3 class="text-2xl font-semibold mb-4" data-lang-key="settings_title">অ্যাকাউন্ট সেটিংস</h3>
                              <div class="glass-effect p-6 rounded-lg">
                               <div id="profile-display" class="mb-6">
                                    <h4 id="profile-full-name" class="text-xl font-bold"></h4>
                                    <p id="profile-email"></p>
                                    <p id="profile-mobile"></p>
                               </div>
                               <h4 class="text-xl font-semibold mb-3" data-lang-key="payout_title">প্রোফাইল ও পেমেন্ট তথ্য</h4>
                               <p class="text-sm mb-4" data-lang-key="payout_desc">আপনার পণ্য বিক্রি হলে, আমরা নিচের তথ্যে আপনাকে পেমেন্ট পাঠাব।</p>
                               <form id="settings-form" class="space-y-4">
                                    <h5 class="text-lg font-semibold border-b border-gray-700 pb-2" data-lang-key="settings_optional_title">ঐচ্ছিক তথ্য (প্রোফাইল পূর্ণ করুন)</h5>
                                    <textarea id="settings-address" placeholder="আপনার ঠিকানা" rows="3" class="w-full bg-gray-800 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500"></textarea>
                                    <input id="settings-house" type="text" placeholder="বাড়ির নম্বর" class="w-full bg-gray-800 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500">
                                    <input id="settings-zip" type="text" placeholder="জিপ কোড" class="w-full bg-gray-800 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500">
                                    
                                    <h5 class="text-lg font-semibold border-b border-gray-700 pb-2 pt-4" data-lang-key="payout_title">পেমেন্ট পাওয়ার তথ্য</h5>
                                    <select id="payout-method" class="w-full bg-gray-800 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500">
                                        <option value="bKash">বিকাশ</option>
                                        <option value="Nagad">নগদ</option>
                                        <option value="Rocket">রকেট</option>
                                    </select>
                                    <input id="payout-number" type="text" placeholder="আপনার অ্যাকাউন্ট নম্বর" class="w-full bg-gray-800 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" required>
                                    <button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg transition" data-lang-key="payout_save_btn">তথ্য সেভ করুন</button>
                               </form>
                             </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer (Customer) -->
        <footer id="customer-footer" class="bg-black py-8">
            <div class="container mx-auto px-6 text-center">
                <div class="flex justify-center items-center gap-6 mb-4">
                    <a href="#" aria-label="Facebook" class="text-gray-400 hover:text-white"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" clip-rule="evenodd" /></svg></a>
                    <a href="#" aria-label="YouTube" class="text-gray-400 hover:text-white"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path fill-rule="evenodd" d="M19.812 5.418c.861.23 1.538.907 1.768 1.768C21.998 8.78 22 12 22 12s0 3.22-.42 4.814a2.506 2.506 0 0 1-1.768 1.768c-1.594.42-7.812.42-7.812.42s-6.218 0-7.812-.42a2.506 2.506 0 0 1-1.768-1.768C2 15.22 2 12 2 12s0-3.22.42-4.814a2.506 2.506 0 0 1 1.768-1.768C5.782 5 12 5 12 5s6.218 0 7.812.418ZM15.194 12 10 15.194V8.806L15.194 12Z" clip-rule="evenodd" /></svg></a>
                    <a href="#" aria-label="TikTok" class="text-gray-400 hover:text-white"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.1 1.58-2.91 2.34-4.82 2.34-1.43 0-2.83-.53-3.91-1.48-1.58-1.38-2.26-3.39-2.18-5.34 0-.04.01-.08.01-.12.02-1.58.43-3.12 1.2-4.44.83-1.4 2.02-2.43 3.48-3.03.01-.05.02-.09.02-.14.01-2.24-.02-4.48-.01-6.72 0-.25.01-.5.01-.75.01-.68.01-1.37.02-2.05.02-.7.01-1.4-.01-2.1.01-.15.02-.3.02-.45.01-.1.02-.2.02-.31.02-.22.01-.44.01-.66 0-.08.01-.16.01-.24z"/></svg></a>
                    <a href="#" aria-label="Telegram" class="text-gray-400 hover:text-white"><svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24"><path d="m9.417 15.181-.397 5.584c.568 0 .814-.244 1.109-.537l2.663-2.545 5.518 4.041c1.012.564 1.725.267 1.998-.931L23.613 3.106c.338-1.393-.564-2.001-1.517-1.592L.617 10.431C-1.214 11.12-1.214 12.21.901 12.565l5.703.874 13.22-8.26C20.533 4.41 19.88 4.878 19.17 5.421z"/></svg></a>
                </div>
                <div class="flex justify-center gap-4 mb-4">
                    <a href="#" data-action="openModal" data-modal-id="terms-modal" class="hover:text-yellow-400" data-lang-key="footer_terms">টার্মস এন্ড কন্ডিশনস</a>
                    <span class="text-gray-500">|</span>
                    <a href="#" class="hover:text-yellow-400" data-lang-key="footer_support">সাপোর্ট</a>
                </div>
                <p data-lang-key="footer_copyright">&copy; ২০২৫ পছন্দের শপ। সর্বসত্ত্ব সংরক্ষিত।</p>
            </div>
        </footer>

        <!-- Main Admin Panel (Initially Hidden) -->
        <div id="admin-panel" class="flex h-full w-full hidden">
            <!-- Sidebar -->
            <aside class="w-64 bg-gray-800 text-gray-300 flex flex-col">
                <div class="p-4 text-center text-2xl font-bold text-white border-b border-gray-700">অ্যাডমিন</div>
                <nav id="sidebar-nav" class="flex-1 p-4 space-y-2">
                    <button data-target="dashboard" class="w-full text-left sidebar-item p-3 rounded-md hover:bg-gray-700 transition active">ড্যাশবোর্ড</button>
                    <button data-target="users" class="w-full text-left sidebar-item p-3 rounded-md hover:bg-gray-700 transition">ব্যবহারকারী</button>
                    <button data-target="products" class="w-full text-left sidebar-item p-3 rounded-md hover:bg-gray-700 transition">পণ্যসমূহ</button>
                    <button data-target="seller-products" class="w-full text-left sidebar-item p-3 rounded-md hover:bg-gray-700 transition relative">বিক্রেতার পণ্য <span id="review-count" class="absolute right-2 top-1/2 -translate-y-1/2 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span></button>
                    <button data-target="orders" class="w-full text-left sidebar-item p-3 rounded-md hover:bg-gray-700 transition">অর্ডার</button>
                    <button data-target="promotions" class="w-full text-left sidebar-item p-3 rounded-md hover:bg-gray-700 transition">প্রমোশন</button>
                    <button data-target="content" class="w-full text-left sidebar-item p-3 rounded-md hover:bg-gray-700 transition">কনটেন্ট</button>
                    <button data-target="site-settings" class="w-full text-left sidebar-item p-3 rounded-md hover:bg-gray-700 transition">সাইট সেটিংস</button>
                </nav>
                <div class="p-4 border-t border-gray-700">
                    <button id="logout-btn" class="w-full bg-red-600 hover:bg-red-700 text-white p-3 rounded-md transition">লগআউট</button>
                </div>
            </aside>

            <!-- Main Content (Admin) -->
            <main class="flex-1 p-6 md:p-10 overflow-y-auto">
                <!-- Dashboard View -->
                <div id="dashboard-view" class="admin-view">
                    <h1 class="text-3xl font-bold text-white mb-8">ড্যাশবোর্ড</h1>
                    <div class="flex flex-col lg:flex-row gap-8">
                        <!-- Main Stats -->
                        <div class="flex-grow">
                            <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                                <div class="stat-card p-6 rounded-lg shadow-lg">
                                    <h3 class="text-gray-400 text-lg">মোট ব্যবহারকারী</h3>
                                    <p id="total-users" class="text-3xl font-bold text-white mt-2">0</p>
                                </div>
                                <div class="stat-card p-6 rounded-lg shadow-lg">
                                    <h3 class="text-gray-400 text-lg">মোট অর্ডার</h3>
                                    <p id="total-orders" class="text-3xl font-bold text-white mt-2">0</p>
                                </div>
                                 <div class="stat-card p-6 rounded-lg shadow-lg">
                                    <h3 class="text-gray-400 text-lg">আজকের আয়</h3>
                                    <p id="daily-revenue" class="text-3xl font-bold text-green-400 mt-2">৳0</p>
                                </div>
                                <div class="stat-card p-6 rounded-lg shadow-lg">
                                    <h3 class="text-gray-400 text-lg">এই মাসের আয়</h3>
                                    <p id="monthly-revenue" class="text-3xl font-bold text-green-400 mt-2">৳0</p>
                                </div>
                                <div class="stat-card p-6 rounded-lg shadow-lg">
                                    <h3 class="text-gray-400 text-lg">সাইট ভিজিট</h3>
                                    <p id="site-visits" class="text-3xl font-bold text-white mt-2">0</p>
                                </div>
                            </div>
                        </div>
                        <!-- Calculator -->
                        <div class="lg:w-auto">
                            <div class="bg-gray-800 p-4 rounded-lg w-full max-w-xs mx-auto lg:mx-0">
                                <h2 class="text-xl font-bold text-white mb-4">ক্যালকুলেটর</h2>
                                <div class="bg-gray-900 p-3 rounded-md text-right text-2xl font-mono mb-3" id="calculator-display">0</div>
                                <div id="calculator-keys" class="grid grid-cols-4 gap-2">
                                    <button class="p-3 bg-gray-700 rounded-md text-lg hover:bg-gray-600 transition" data-action="clear">AC</button>
                                    <button class="p-3 bg-gray-700 rounded-md text-lg hover:bg-gray-600 transition" data-action="delete">C</button>
                                    <button class="p-3 bg-yellow-500 text-black rounded-md text-lg hover:bg-yellow-600 transition" data-operator="divide">/</button>
                                    <button class="p-3 bg-yellow-500 text-black rounded-md text-lg hover:bg-yellow-600 transition" data-operator="multiply">*</button>
                                    <button class="p-3 bg-gray-600 rounded-md text-lg hover:bg-gray-500 transition">7</button>
                                    <button class="p-3 bg-gray-600 rounded-md text-lg hover:bg-gray-500 transition">8</button>
                                    <button class="p-3 bg-gray-600 rounded-md text-lg hover:bg-gray-500 transition">9</button>
                                    <button class="p-3 bg-yellow-500 text-black rounded-md text-lg hover:bg-yellow-600 transition" data-operator="subtract">-</button>
                                    <button class="p-3 bg-gray-600 rounded-md text-lg hover:bg-gray-500 transition">4</button>
                                    <button class="p-3 bg-gray-600 rounded-md text-lg hover:bg-gray-500 transition">5</button>
                                    <button class="p-3 bg-gray-600 rounded-md text-lg hover:bg-gray-500 transition">6</button>
                                    <button class="p-3 bg-yellow-500 text-black rounded-md text-lg hover:bg-yellow-600 transition" data-operator="add">+</button>
                                    <button class="p-3 bg-gray-600 rounded-md text-lg hover:bg-gray-500 transition">1</button>
                                    <button class="p-3 bg-gray-600 rounded-md text-lg hover:bg-gray-500 transition">2</button>
                                    <button class="p-3 bg-gray-600 rounded-md text-lg hover:bg-gray-500 transition">3</button>
                                    <button class="p-3 bg-green-500 text-black rounded-md text-lg hover:bg-green-600 transition row-span-2" data-action="calculate">=</button>
                                    <button class="p-3 bg-gray-600 rounded-md text-lg hover:bg-gray-500 transition col-span-2">0</button>
                                    <button class="p-3 bg-gray-600 rounded-md text-lg hover:bg-gray-500 transition" data-action="decimal">.</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Users View -->
                <div id="users-view" class="admin-view hidden">
                    <h1 class="text-3xl font-bold text-white mb-8">ব্যবহারকারী ব্যবস্থাপনা</h1>
                    <div class="bg-gray-800 rounded-lg shadow-lg overflow-x-auto">
                        <table class="w-full text-left table-auto">
                            <thead class="bg-gray-700">
                                <tr><th class="p-4">নাম</th><th class="p-4">ইমেইল</th><th class="p-4">স্ট্যাটাস</th><th class="p-4">অ্যাকশন</th></tr>
                            </thead>
                            <tbody id="users-table-body"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Products View -->
                <div id="products-view" class="admin-view hidden">
                    <div class="flex justify-between items-center mb-8">
                        <h1 class="text-3xl font-bold text-white">পণ্য ব্যবস্থাপনা</h1>
                        <button id="add-product-btn" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg">নতুন পণ্য যোগ করুন</button>
                    </div>
                    <div class="bg-gray-800 rounded-lg shadow-lg overflow-x-auto">
                        <table class="w-full text-left table-auto">
                            <thead class="bg-gray-700">
                                <tr><th class="p-4">নাম</th><th class="p-4">ক্যাটেগরি</th><th class="p-4">মূল্য</th><th class="p-4">অ্যাকশন</th></tr>
                            </thead>
                            <tbody id="products-table-body"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Seller Products View -->
                <div id="seller-products-view" class="admin-view hidden">
                     <h1 class="text-3xl font-bold text-white mb-8">বিক্রেতার পণ্য রিভিউ</h1>
                     <div class="bg-gray-800 rounded-lg shadow-lg overflow-x-auto">
                         <table class="w-full text-left table-auto">
                             <thead class="bg-gray-700">
                                 <tr><th class="p-4">নাম</th><th class="p-4">বিক্রেতা</th><th class="p-4">মূল্য</th><th class="p-4">স্ট্যাটাস</th><th class="p-4">অ্যাকশন</th></tr>
                             </thead>
                             <tbody id="seller-products-table-body"></tbody>
                         </table>
                    </div>
                </div>

                <!-- Orders View -->
                <div id="orders-view" class="admin-view hidden">
                    <h1 class="text-3xl font-bold text-white mb-8">অর্ডার ব্যবস্থাপনা</h1>
                    <div class="bg-gray-800 rounded-lg shadow-lg overflow-x-auto">
                        <table class="w-full text-left table-auto">
                            <thead class="bg-gray-700">
                                 <tr><th class="p-4">অর্ডার আইডি</th><th class="p-4">ক্রেতার আইডি</th><th class="p-4">পরিমাণ</th><th class="p-4">TrxID</th><th class="p-4">স্ট্যাটাস</th></tr>
                            </thead>
                            <tbody id="orders-table-body"></tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Promotions View -->
                <div id="promotions-view" class="admin-view hidden">
                     <h1 class="text-3xl font-bold text-white mb-8">প্রমোশন ও কুপন</h1>
                     <div class="bg-gray-800 p-6 rounded-lg mb-8">
                           <h2 class="text-xl font-bold mb-4">নতুন কুপন তৈরি করুন</h2>
                           <form id="coupon-form" class="flex gap-4 items-end">
                                 <div class="flex-grow"><label>কুপন কোড</label><input id="coupon-code" type="text" class="w-full bg-gray-700 p-2 rounded mt-1" required></div>
                                 <div><label>ডিসকাউন্ট (%)</label><input id="coupon-discount" type="number" class="w-full bg-gray-700 p-2 rounded mt-1" required></div>
                                 <button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg">তৈরি করুন</button>
                           </form>
                     </div>
                     <div class="bg-gray-800 rounded-lg shadow-lg overflow-x-auto">
                          <table class="w-full text-left table-auto"><thead class="bg-gray-700"><tr><th class="p-4">কোড</th><th class="p-4">ডিসকাউন্ট</th><th class="p-4">অ্যাকশন</th></tr></thead><tbody id="coupons-table-body"></tbody></table>
                     </div>
                </div>

                <!-- Content View -->
                <div id="content-view" class="admin-view hidden">
                    <h1 class="text-3xl font-bold text-white mb-8">স্লাইডার ব্যানার ব্যবস্থাপনা</h1>
                    <div class="bg-gray-800 p-6 rounded-lg mb-8">
                           <h2 class="text-xl font-bold mb-4">নতুন ব্যানার যোগ করুন</h2>
                           <form id="banner-form" class="space-y-4">
                                <input id="banner-title" type="text" placeholder="ব্যানার টাইটেল" class="w-full bg-gray-700 p-2 rounded" required>
                                <input id="banner-desc" type="text" placeholder="ছোট বিবরণ" class="w-full bg-gray-700 p-2 rounded" required>
                                <input id="banner-img" type="text" placeholder="ছবির URL" class="w-full bg-gray-700 p-2 rounded" required>
                                <button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg">যোগ করুন</button>
                           </form>
                    </div>
                     <div class="bg-gray-800 rounded-lg shadow-lg overflow-x-auto">
                          <table class="w-full text-left table-auto"><thead class="bg-gray-700"><tr><th class="p-4">টাইটেল</th><th class="p-4">ছবি</th><th class="p-4">অ্যাকশন</th></tr></thead><tbody id="banners-table-body"></tbody></table>
                     </div>
                </div>
                
                <!-- Site Settings View -->
                <div id="site-settings-view" class="admin-view hidden">
                    <h1 class="text-3xl font-bold text-white mb-8">সাইট পেমেন্ট সেটিংস</h1>
                    <div class="bg-gray-800 p-6 rounded-lg">
                        <p class="text-gray-400 mb-4">গ্রাহকদের কাছ থেকে পেমেন্ট গ্রহণের জন্য এখানে আপনার পেমেন্ট গেটওয়ের তথ্য দিন।</p>
                        <form id="admin-site-settings-form" class="space-y-4">
                            <input id="site-payment-gateway" type="text" placeholder="পেমেন্ট গেটওয়ের নাম (যেমন: বিকাশ)" class="w-full bg-gray-700 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500">
                            <input id="site-payment-number" type="text" placeholder="মার্চেন্ট/এজেন্ট নম্বর" class="w-full bg-gray-700 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500">
                            <button type="submit" class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg">তথ্য সেভ করুন</button>
                        </form>
                    </div>
                </div>
            </main>
        </div>
    </div>


    <!-- MODALS (Customer & Admin) -->
    
    <!-- Notification -->
    <div id="notification" class="notification"></div>
    
    <!-- Auth Modal (Customer) -->
    <div id="auth-modal" class="modal-overlay">
        <div class="modal-content">
            <button data-action="closeModal" data-modal-id="auth-modal" class="absolute top-4 right-4 hover:text-white text-2xl font-bold">&times;</button>
            <div id="login-view">
                 <h3 class="text-2xl font-bold text-center mb-6" data-lang-key="login_title">স্বাগতম!</h3>
                 <form id="customer-login-form" class="space-y-4">
                     <input id="login-email" type="email" placeholder="আপনার ইমেইল" class="w-full bg-gray-800 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" required>
                     <input id="login-password" type="password" placeholder="আপনার পাসওয়ার্ড" class="w-full bg-gray-800 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" required>
                     <button type="submit" class="w-full bg-yellow-500 hover:bg-yellow-600 font-bold py-3 px-4 rounded-lg transition duration-300" data-lang-key="login_form_btn">লগইন করুন</button>
                 </form>
                 <div class="mt-6 text-center">
                     <p class="text-sm" data-lang-key="login_no_account">অ্যাকাউন্ট নেই?</p>
                     <button type="button" data-action="showRegisterView" class="w-full mt-2 py-2 px-4 border border-yellow-500 text-yellow-500 rounded-lg hover:bg-yellow-500 hover:text-black transition" data-lang-key="login_create_account">এখনি তৈরি করুন</button>
                 </div>
            </div>
            <div id="register-view" class="hidden">
                 <h3 class="text-2xl font-bold text-center mb-6" data-lang-key="register_title">অ্যাকাউন্ট তৈরি করুন</h3>
                 <form id="register-form" class="space-y-4">
                     <input id="register-name" type="text" placeholder="আপনার পুরো নাম" class="w-full bg-gray-800 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" required>
                     <input id="register-mobile" type="tel" placeholder="আপনার মোবাইল নম্বর" class="w-full bg-gray-800 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" required>
                     <input id="register-email" type="email" placeholder="আপনার ইমেইল" class="w-full bg-gray-800 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" required>
                     <input id="register-password" type="password" placeholder="একটি পাসওয়ার্ড দিন" class="w-full bg-gray-800 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" required>
                     <input id="register-confirm-password" type="password" placeholder="পাসওয়ার্ডটি আবার দিন" class="w-full bg-gray-800 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" required>
                     <div class="flex items-center space-x-2">
                         <input type="checkbox" id="register-terms" class="h-4 w-4 bg-gray-800 border-gray-600 text-yellow-500 focus:ring-yellow-600" required>
                         <label for="register-terms" class="text-sm" data-lang-key="register_terms_agree">আমি <a href="#" data-action="openModal" data-modal-id="terms-modal" class="text-yellow-400 hover:underline" data-lang-key="footer_terms">শর্তাবলীতে</a> সম্মত।</label>
                     </div>
                     <button type="submit" class="w-full bg-yellow-500 hover:bg-yellow-600 font-bold py-3 px-4 rounded-lg transition duration-300" data-lang-key="register_form_btn">রেজিস্টার করুন</button>
                 </form>
                 <div class="mt-6 text-center">
                     <p class="text-sm" data-lang-key="register_has_account">ইতিমধ্যে অ্যাকাউন্ট আছে?</p>
                     <button type="button" data-action="showLoginView" class="w-full mt-2 py-2 px-4 border border-yellow-500 text-yellow-500 rounded-lg hover:bg-yellow-500 hover:text-black transition" data-lang-key="register_login">লগইন করুন</button>
                 </div>
            </div>
        </div>
    </div>
    
    <!-- Cart Modal -->
    <div id="cart-modal" class="modal-overlay">
        <div class="modal-content max-w-md">
            <button data-action="closeModal" data-modal-id="cart-modal" class="absolute top-4 right-4 hover:text-white text-2xl font-bold">&times;</button>
            <h3 class="text-2xl font-bold mb-6" data-lang-key="cart_title">আপনার কার্ট</h3>
            <div id="cart-items" class="space-y-4 max-h-[60vh] overflow-y-auto pr-2">
                <!-- Cart items will be injected here -->
            </div>
            <div class="mt-6 border-t border-gray-700 pt-4">
                <div class="flex justify-between items-center font-bold text-lg">
                    <span data-lang-key="cart_total">নির্বাচিত মোট:</span>
                    <span id="cart-total">৳০</span>
                </div>
                <button id="checkout-btn" class="w-full mt-4 bg-yellow-500 hover:bg-yellow-600 font-bold py-3 px-4 rounded-lg transition duration-300" data-lang-key="cart_checkout">চেকআউট করুন</button>
            </div>
        </div>
    </div>
    
    <!-- Payment Modal -->
    <div id="payment-modal" class="modal-overlay">
        <div class="modal-content">
            <button data-action="closeModal" data-modal-id="payment-modal" class="absolute top-4 right-4 hover:text-white text-2xl font-bold">&times;</button>
            <h3 class="text-2xl font-bold text-center mb-4" data-lang-key="payment_title">পেমেন্ট সম্পন্ন করুন</h3>
            <div class="text-center p-4 bg-gray-800 rounded-lg">
                <p data-lang-key="payment_instruction_1">নিচের নম্বরে সর্বমোট <strong id="payment-amount" class="text-yellow-400"></strong> টাকা পাঠান।</p>
                <p id="gateway-number" class="text-2xl font-bold my-2 text-green-400">লোড হচ্ছে...</p>
                <p class="text-sm" data-lang-key="payment_instruction_2">(এটি একটি <span id="gateway-name"></span> নম্বর, পেমেন্ট অপশন ব্যবহার করুন)</p>
            </div>
            <form id="payment-form" class="space-y-4 mt-6">
                 <input id="payment-phone" type="text" placeholder="যে নম্বর থেকে টাকা পাঠিয়েছেন" class="w-full bg-gray-800 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" required>
                 <input id="payment-trxid" type="text" placeholder="ট্রানজকশন আইডি (TrxID)" class="w-full bg-gray-800 p-3 rounded-md focus:outline-none focus:ring-2 focus:ring-yellow-500" required>
                 <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition" data-lang-key="payment_confirm_btn">অর্ডার কনফার্ম করুন</button>
            </form>
        </div>
    </div>

    <!-- Terms Modal -->
    <div id="terms-modal" class="modal-overlay">
        <div class="modal-content max-w-2xl">
            <button data-action="closeModal" data-modal-id="terms-modal" class="absolute top-4 right-4 hover:text-white text-2xl font-bold">&times;</button>
            <h3 class="text-2xl font-bold text-center mb-6" data-lang-key="terms_title">টার্মস এন্ড কন্ডিশনস</h3>
            <div class="space-y-4 max-h-96 overflow-y-auto pr-4">
                <p data-lang-key="terms_p1">আমাদের ওয়েবসাইটে আপনাকে স্বাগতম। এই সাইট ব্যবহার করার মাধ্যমে, আপনি আমাদের শর্তাবলীর সাথে একমত হচ্ছেন।</p>
                <p data-lang-key="terms_p2">যেকোনো পণ্য কেনার আগে তার বিবরণ ভালোভাবে পড়ে নিন। ডিজিটাল পণ্য হওয়ায় কোনো রিফান্ডের ব্যবস্থা নেই। আমাদের কন্টেন্ট কপি করা নিষিদ্ধ।</p>
            </div>
        </div>
    </div>

    <!-- Product Details Modal (Customer) -->
    <div id="product-details-modal" class="modal-overlay">
        <div class="modal-content max-w-3xl">
            <button data-action="closeModal" data-modal-id="product-details-modal" class="absolute top-4 right-4 hover:text-white text-2xl font-bold">&times;</button>
            <div id="product-details-content" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <img id="details-img" src="https://placehold.co/600x400/1e293b/ffffff?text=Product" class="w-full h-auto object-cover rounded-lg mb-4">
                     <div class="grid grid-cols-2 gap-2">
                         <button data-action="addToCart" id="details-add-to-cart-btn" class="w-full bg-yellow-500 hover:bg-yellow-600 font-bold py-2 px-3 rounded-lg transition duration-300 text-sm" data-lang-key="add_to_cart_btn"></button>
                         <button data-action="buyNow" id="details-buy-now-btn" class="w-full bg-gray-600 hover:bg-gray-700 font-bold py-2 px-3 rounded-lg transition duration-300 text-sm" data-lang-key="buy_now_btn"></button>
                    </div>
                </div>
                <div class="max-h-[70vh] overflow-y-auto pr-4">
                    <h3 id="details-name" class="text-3xl font-bold mb-2"></h3>
                    <p class="text-2xl font-semibold text-yellow-400 mb-4"><span id="details-price"></span></p>
                    <p class="mb-4"><strong data-lang-key="details_category">ক্যাটেগরি:</strong> <span id="details-category"></span></p>
                    <p id="details-desc" class="text-gray-300 mb-6"></p>
                    <div class="border-t border-gray-700 pt-6">
                        <h4 class="text-xl font-semibold mb-4" data-lang-key="reviews_title">কাস্টমার রিভিউ</h4>
                        <div id="reviews-list" class="space-y-4 mb-6"></div>
                        <div id="review-form-container"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Add/Edit Modal (Admin) -->
    <div id="product-modal" class="modal">
        <div class="bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-lg modal-content">
            <h2 id="product-modal-title" class="text-2xl font-bold mb-6">নতুন পণ্য</h2>
            <form id="product-form" class="space-y-4">
                <input type="hidden" id="product-id">
                <input id="product-name" type="text" placeholder="পণ্যের নাম" class="w-full bg-gray-700 p-3 rounded" required>
                <textarea id="product-desc" placeholder="পণ্যের বিবরণ" rows="3" class="w-full bg-gray-700 p-3 rounded"></textarea>
                <input id="product-price" type="number" placeholder="মূল্য" class="w-full bg-gray-700 p-3 rounded" required>
                <input id="product-category" type="text" placeholder="ক্যাটেগরি" class="w-full bg-gray-700 p-3 rounded" required>
                <input id="product-image" type="text" placeholder="ছবির URL" class="w-full bg-gray-700 p-3 rounded" required>
                <div class="flex justify-end gap-4 pt-4">
                    <button type="button" data-action="closeModal" data-modal-id="product-modal" class="bg-gray-600 hover:bg-gray-700 py-2 px-4 rounded"> বাতিল</button>
                    <button type="submit" class="bg-green-500 hover:bg-green-600 py-2 px-4 rounded">সেভ করুন</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- User Details Modal (Admin) -->
    <div id="user-details-modal" class="modal">
        <div class="bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-lg modal-content">
            <h2 class="text-2xl font-bold mb-6">ব্যবহারকারীর বিবরণ</h2>
            <div id="user-details-content" class="space-y-2"></div>
            <div class="flex justify-end pt-4">
                <button type="button" data-action="closeModal" data-modal-id="user-details-modal" class="bg-gray-600 hover:bg-gray-700 py-2 px-4 rounded">বন্ধ করুন</button>
            </div>
        </div>
    </div>

    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithCustomToken, signInAnonymously, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, getDocs, onSnapshot, addDoc, deleteDoc, doc, setDoc, getDoc, query, where, serverTimestamp, writeBatch, updateDoc, increment } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Configuration and Initialization ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfigString = typeof __firebase_config !== 'undefined' ? __firebase_config : null;
        const ADMIN_UID = "mjbmQXTqIKd3QBltUWnfBVDN8MF2";
        
        const firebaseConfig = firebaseConfigString ? JSON.parse(firebaseConfigString) : { /* Fallback config */
            apiKey: "AIzaSyB6rH8V0TClZ_aigoUBPrS8BFzscG9_Dz8",
            authDomain: "e-site-62560.firebaseapp.com",
            databaseURL: "https://e-site-62560-default-rtdb.firebaseio.com",
            projectId: "e-site-62560",
            storageBucket: "e-site-62560.firebasestorage.app",
            messagingSenderId: "823317877501",
            appId: "1:823317877501:web:112d400e1f45533613a494",
            measurementId: "G-V5933K4NYK"
        };
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        
        // --- Global Variables and State ---
        let app, auth, db;
        let notificationTimeout;
        
        const state = {
            products: [], banners: [], cart: [], favorites: [], user: null, userProfile: null, siteSettings: null, allOrders: [],
            currentCategory: 'All', searchTerm: '', checkoutItems: [], selectedCartItemIds: new Set(),
            currentOpenProduct: null,
            unsubscribers: {
                reviews: () => {}, products: () => {}, banners: () => {}, cart: () => {}, favorites: () => {}, orders: () => {}, siteSettings: () => {}, allOrders: () => {},
                adminUsers: () => {}, adminProducts: () => {}, adminSellerProducts: () => {}, adminOrders: () => {}, adminPromotions: () => {}, adminContent: () => {}, adminSiteSettings: () => {}, adminPendingReviews: () => {}
            }
        };

        const translations = {
            bn: { site_title: "পছন্দের শপ", nav_home: "হোম", nav_products: "প্রোডাক্টস", nav_sell: "পণ্য সেল করুন", nav_account: "আমার অ্যাকাউন্ট", search_placeholder: "প্রোডাক্ট খুঁজুন...", login_btn: "লগইন", logout_btn: "লগআউট", hero_title: "আপনার প্রয়োজনীয় সকল ডিজিটাল প্রোডাক্টস", hero_subtitle: "ওয়েব টেমপ্লেট, গ্রাফিক্স ডিজাইন, সফটওয়্যার এবং আরও অনেক কিছু, সবই এক জায়গায়।", hero_button: "প্রোডাক্ট দেখুন", products_title: "আমাদের সেরা প্রোডাক্টস", footer_terms: "টার্মস এন্ড কন্ডিশনস", footer_copyright: "© ২০২৫ পছন্দের শপ। সর্বসত্ত্ব সংরক্ষিত।", footer_support: "সাপোর্ট", terms_title: "টার্মস এন্ড কন্ডিশনস", terms_p1: "আমাদের ওয়েবসাইটে আপনাকে স্বাগতম। এই সাইট ব্যবহার করার মাধ্যমে, আপনি আমাদের শর্তাবলীর সাথে একমত হচ্ছেন।", terms_p2: "যেকোনো পণ্য কেনার আগে তার বিবরণ ভালোভাবে পড়ে নিন। ডিজিটাল পণ্য হওয়ায় কোনো রিফান্ডের ব্যবস্থা নেই। আমাদের কন্টেন্ট কপি করা নিষিদ্ধ।", slide1_title: "সকল ওয়েব টেমপ্লেটে ৫০% ছাড়!", slide1_desc: "আপনার স্বপ্নের ওয়েবসাইট বানান আমাদের প্রিমিয়াম টেমপ্লেট দিয়ে।", slide2_title: "এসে গেছে নতুন গ্রাফিক্স ডিজাইন কালেকশন", slide2_desc: "আপনার প্রজেক্টকে ফুটিয়ে তুলুন নতুন আঙ্গিকে।", login_title: "স্বাগতম!", login_form_btn: "লগইন করুন", login_no_account: "অ্যাকাউন্ট নেই?", login_create_account: "এখনি তৈরি করুন", register_title: "অ্যাকাউন্ট তৈরি করুন", register_form_btn: "রেজিস্টার করুন", register_has_account: "ইতিমধ্যে অ্যাকাউন্ট আছে?", register_login: "লগইন করুন", register_terms_agree: "আমি", dashboard_title: "আমার অ্যাকাউন্ট ড্যাশবোর্ড", dashboard_nav_orders: "আমার অর্ডার", dashboard_nav_favorites: "ফেভারিট পণ্য", dashboard_nav_upload: "আপনার পণ্য আপলোড করুন", dashboard_nav_settings: "সেটিংস", dashboard_nav_site_settings: "সাইট সেটিংস", dashboard_nav_all_orders: "সকল অর্ডার", site_settings_title: "সাইট পেমেন্ট সেটিংস", site_settings_desc: "গ্রাহকদের কাছ থেকে পেমেন্ট গ্রহণের জন্য এখানে আপনার পেমেন্ট গেটওয়ের তথ্য দিন।", orders_title: "অর্ডার হিস্টোরি", all_orders_title: "সকল কাস্টমার অর্ডার", orders_none: "আপনার কোনো অর্ডার নেই।", favorites_title: "আপনার ফেভারিট পণ্য", favorites_none: "আপনার পছন্দের তালিকা খালি।", upload_title: "নতুন পণ্য যোগ করুন", upload_button: "পণ্য আপলোড করুন", settings_title: "অ্যাকাউন্ট সেটিংস", settings_optional_title: "ঐচ্ছিক তথ্য (প্রোফাইল পূর্ণ করুন)", payout_title: "পেমেন্ট পাওয়ার তথ্য", payout_desc: "আপনার পণ্য বিক্রি হলে, আমরা নিচের তথ্যে আপনাকে পেমেন্ট পাঠাব।", payout_save_btn: "তথ্য সেভ করুন", add_to_cart_btn: "কার্টে যোগ করুন", buy_now_btn: "এখনই কিনুন", cart_title: "আপনার কার্ট", cart_total: "নির্বাচিত মোট:", cart_checkout: "চেকআউট করুন", cart_empty: "আপনার কার্ট খালি।", payment_title: "পেমেন্ট সম্পন্ন করুন", payment_instruction_1: "নিচের নম্বরে সর্বমোট", payment_instruction_2: "(এটি একটি মার্চেন্ট নম্বর, পেমেন্ট অপশন ব্যবহার করুন)", payment_confirm_btn: "অর্ডার কনফার্ম করুন", loading_text: "লোড হচ্ছে...", critical_error: "একটি গুরুতর সমস্যা হয়েছে। অনুগ্রহ করে পৃষ্ঠাটি রিফ্রেশ করুন।", details_category: "ক্যাটেগরি", reviews_title: "কাস্টমার রিভিউ", reviews_none: "এখনো কোনো রিভিউ নেই।", review_form_title: "আপনার রিভিউ দিন", review_form_placeholder: "আপনার মতামত লিখুন...", review_form_submit: "রিভিউ জমা দিন", product_views: "ভিউ" },
            en: { site_title: "Pochonder Shop", nav_home: "Home", nav_products: "Products", nav_sell: "Sell Product", nav_account: "My Account", search_placeholder: "Search for products...", login_btn: "Login", logout_btn: "Logout", hero_title: "All The Digital Products You Need", hero_subtitle: "Web templates, graphic designs, software, and much more, all in one place.", hero_button: "Browse Products", products_title: "Our Best Products", footer_terms: "Terms & Conditions", footer_copyright: "© 2025 Pochonder Shop. All rights reserved.", footer_support: "Support", terms_title: "Terms & Conditions", terms_p1: "Welcome to our website. By using this site, you agree to our terms and conditions.", terms_p2: "Please read the product descriptions carefully before purchasing. As these are digital products, there are no refunds. Copying our content is prohibited.", slide1_title: "50% Off On All Web Templates!", slide1_desc: "Build your dream website with our premium templates.", slide2_title: "New Graphics Design Collection Arrived", slide2_desc: "Elevate your project with a fresh new look.", login_title: "Welcome!", login_form_btn: "Log In", login_no_account: "No account?", login_create_account: "Create one now", register_title: "Create Account", register_form_btn: "Register", register_has_account: "Already have an account?", register_login: "Log In", register_terms_agree: "I agree to the", dashboard_title: "My Account Dashboard", dashboard_nav_orders: "My Orders", dashboard_nav_favorites: "Favorite Products", dashboard_nav_upload: "Upload Your Product", dashboard_nav_settings: "Settings", dashboard_nav_site_settings: "Site Settings", dashboard_nav_all_orders: "All Orders", site_settings_title: "Site Payment Settings", site_settings_desc: "Provide your payment gateway information here to receive payments from customers.", orders_title: "Order History", all_orders_title: "All Customer Orders", orders_none: "You have no orders.", favorites_title: "Your Favorite Products", favorites_none: "Your favorites list is empty.", upload_title: "Add New Product", upload_button: "Upload Product", settings_title: "Account Settings", settings_optional_title: "Optional Info (Complete Profile)", payout_title: "Payout Information", payout_desc: "When your product sells, we will send the payment to the details below.", payout_save_btn: "Save Information", add_to_cart_btn: "Add to Cart", buy_now_btn: "Buy Now", cart_title: "Your Cart", cart_total: "Selected Total:", cart_checkout: "Checkout", cart_empty: "Your cart is empty.", payment_title: "Complete Payment", payment_instruction_1: "Please send a total of", payment_instruction_2: "(This is a merchant number, please use the Payment option)", payment_confirm_btn: "Confirm Order", loading_text: "Loading...", critical_error: "A critical error has occurred. Please refresh the page.", details_category: "Category", reviews_title: "Customer Reviews", reviews_none: "No reviews yet.", review_form_title: "Leave a Review", review_form_placeholder: "Write your opinion...", review_form_submit: "Submit Review", product_views: "Views" }
        };

        // --- Utility Functions ---
        function showNotification(message, type = 'success') {
            const el = document.getElementById('notification');
            if (!el) return;
            if (notificationTimeout) clearTimeout(notificationTimeout);
            el.innerText = message;
            el.style.backgroundColor = type === 'success' ? '#10B981' : '#EF4444';
            el.classList.add('show');
            notificationTimeout = setTimeout(() => el.classList.remove('show'), 3000);
        }

        // --- UI & Rendering Functions ---
        
        function setLanguage(lang) {
            if (!['bn', 'en'].includes(lang)) lang = 'bn';
            localStorage.setItem('language', lang);
            document.documentElement.lang = lang;
            document.querySelectorAll('[data-lang-key]').forEach(el => {
                const key = el.dataset.langKey;
                const text = translations[lang][key];
                if (text) {
                    if (el.placeholder) el.placeholder = text;
                    else if (key === 'register_terms_agree') {
                         el.innerHTML = `${text} <a href="#" data-action="openModal" data-modal-id="terms-modal" class="text-yellow-400 hover:underline">${translations[lang]['footer_terms']}</a>`;
                    } else el.innerText = text;
                }
            });
            document.getElementById('lang-bn').classList.toggle('bg-yellow-500', lang === 'bn');
            document.getElementById('lang-bn').classList.toggle('text-black', lang === 'bn');
            document.getElementById('lang-en').classList.toggle('bg-yellow-500', lang === 'en');
            document.getElementById('lang-en').classList.toggle('text-black', lang === 'en');
            updateUIForAuthState(state.user);
        }
        
        function applyTheme(theme) {
            const body = document.body;
            const sunIcon = document.getElementById('sun-icon');
            const moonIcon = document.getElementById('moon-icon');
            if (theme === 'light') {
                body.classList.add('light-mode');
                moonIcon.classList.add('hidden');
                sunIcon.classList.remove('hidden');
            } else {
                body.classList.remove('light-mode');
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            }
            localStorage.setItem('theme', theme);
        }

        function updateUIForAuthState(user) {
            const authBtn = document.getElementById('auth-btn');
            const lang = localStorage.getItem('language') || 'bn';
            
            if (user && !user.isAnonymous) {
                authBtn.dataset.langKey = 'logout_btn';
                authBtn.innerText = translations[lang]['logout_btn'];
            } else {
                authBtn.dataset.langKey = 'login_btn';
                authBtn.innerText = translations[lang]['login_btn'];
            }
        }

        function showCustomerView() {
            document.getElementById('customer-header').classList.remove('hidden');
            document.getElementById('main-content').classList.remove('hidden');
            document.getElementById('customer-footer').classList.remove('hidden');
            document.getElementById('admin-panel').classList.add('hidden');
            document.body.classList.remove('flex', 'h-screen');
        }

        function showAdminView() {
            document.getElementById('customer-header').classList.add('hidden');
            document.getElementById('main-content').classList.add('hidden');
            document.getElementById('customer-footer').classList.add('hidden');
            document.getElementById('admin-panel').classList.remove('hidden');
            document.body.classList.add('flex', 'h-screen');
            showAdminPage('dashboard');
        }
        
        // --- CUSTOMER-FACING RENDER FUNCTIONS ---
        function renderProducts() {
            const listEl = document.getElementById('product-list');
            const loadingIndicator = document.getElementById('loading-indicator');
            if(loadingIndicator) loadingIndicator.style.display = 'none';

            listEl.innerHTML = '';
            const filtered = state.products.filter(p => (state.currentCategory === 'All' || p.category === state.currentCategory) && p.name.toLowerCase().includes(state.searchTerm.toLowerCase()));
            
            if (filtered.length === 0) {
                listEl.innerHTML = `<p class="text-center col-span-full">কোনো প্রোডাক্ট পাওয়া যায়নি।</p>`;
                return;
            }

            filtered.forEach(p => {
                const isFav = state.favorites.includes(p.id);
                const originalPriceHTML = p.originalPrice ? `<del class="text-sm">৳${p.originalPrice.toLocaleString('bn-BD')}</del>` : '';
                const card = document.createElement('div');
                card.className = "glass-effect rounded-lg overflow-hidden shadow-lg flex flex-col transform hover:scale-105 transition-transform duration-300";
                card.dataset.productId = p.id;
                card.innerHTML = `
                    <div class="relative">
                         <img data-action="openDetails" class="w-full h-52 object-cover cursor-pointer" src="${p.image}" alt="${p.name}" onerror="this.onerror=null;this.src='https://placehold.co/600x400/1e293b/ffffff?text=Image+Error';">
                         ${p.originalPrice ? `<span class="absolute top-2 left-2 bg-red-500 text-white text-xs font-bold px-2 py-1 rounded">SALE</span>` : ''}
                         <button data-action="toggleFavorite" class="favorite-btn absolute top-2 right-2 hover:text-red-500 transition ${isFav ? 'favorited' : ''} z-10">
                             <svg class="w-6 h-6 pointer-events-none" xmlns="http://www.w3.org/2000/svg" ${isFav ? 'fill="currentColor"' : 'fill="none"'} viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12Z" /></svg>
                         </button>
                    </div>
                    <div class="p-4 flex-grow flex flex-col">
                        <h4 data-action="openDetails" class="text-lg font-bold mb-2 flex-grow cursor-pointer">${p.name}</h4>
                        <div class="flex justify-between items-center text-sm text-gray-400 mb-3">
                            <span>${p.category}</span>
                            <span class="flex items-center gap-1">
                                <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" /></svg>
                                ${p.views || 0}
                            </span>
                        </div>
                        <div class="flex items-baseline gap-2 mb-4">
                            <p class="text-xl font-semibold text-yellow-400">৳${p.price.toLocaleString('bn-BD')}</p>
                            ${originalPriceHTML}
                        </div>
                        <div class="mt-auto grid grid-cols-2 gap-2">
                            <button data-action="addToCart" class="w-full bg-yellow-500 hover:bg-yellow-600 font-bold py-2 px-3 rounded-lg transition duration-300 text-sm" data-lang-key="add_to_cart_btn"></button>
                            <button data-action="buyNow" class="w-full bg-gray-600 hover:bg-gray-700 font-bold py-2 px-3 rounded-lg transition duration-300 text-sm" data-lang-key="buy_now_btn"></button>
                        </div>
                    </div>`;
                listEl.appendChild(card);
            });
            setLanguage(localStorage.getItem('language') || 'bn');
        }

        function renderCart() {
            const itemsEl = document.getElementById('cart-items');
            const totalEl = document.getElementById('cart-total');
            itemsEl.innerHTML = '';
            let selectedTotal = 0;

            if (state.cart.length === 0) {
                itemsEl.innerHTML = `<p data-lang-key="cart_empty"></p>`;
            } else {
                state.cart.forEach(item => {
                    const product = state.products.find(p => p.id === item.productId);
                    if (!product) return;

                    const isSelected = state.selectedCartItemIds.has(item.id);
                    if (isSelected) {
                        selectedTotal += product.price * item.quantity;
                    }

                    const itemEl = document.createElement('div');
                    itemEl.className = 'flex items-center gap-4 p-2 rounded-md hover:bg-gray-800 transition';
                    itemEl.innerHTML = `
                        <input type="checkbox" data-action="toggleCartItemSelection" data-cart-item-id="${item.id}" class="cart-item-checkbox h-5 w-5 flex-shrink-0 rounded bg-gray-700 border-gray-600 text-yellow-500 focus:ring-yellow-600 cursor-pointer" ${isSelected ? 'checked' : ''}>
                        <img src="${product.image}" class="w-16 h-16 object-cover rounded-md">
                        <div class="flex-grow">
                            <h5 class="font-semibold">${product.name}</h5>
                            <p class="text-sm">${item.quantity} x ৳${product.price.toLocaleString('bn-BD')}</p>
                        </div>
                        <button data-action="removeFromCart" data-cart-id="${item.id}" class="text-red-500 hover:text-red-400 text-2xl">&times;</button>
                    `;
                    itemsEl.appendChild(itemEl);
                });
            }
            
            totalEl.innerText = `৳${selectedTotal.toLocaleString('bn-BD')}`;
            document.getElementById('checkout-btn').disabled = state.selectedCartItemIds.size === 0;
            setLanguage(localStorage.getItem('language') || 'bn');
        }
       
        function renderFavoritesInDashboard() {
            const favListEl = document.getElementById('favorites-list');
            favListEl.innerHTML = '';
            const favoritedProducts = state.products.filter(p => state.favorites.includes(p.id));
            if (favoritedProducts.length === 0) {
                favListEl.innerHTML = `<p class="col-span-full" data-lang-key="favorites_none"></p>`;
            } else {
                favoritedProducts.forEach(p => {
                    const card = document.createElement('div');
                    card.className = "glass-effect rounded-lg p-4 flex flex-col";
                    card.innerHTML = `
                        <img src="${p.image}" class="w-full h-32 object-cover rounded-md mb-3">
                        <h5 class="font-semibold flex-grow">${p.name}</h5>
                        <p class="text-yellow-400 mt-1">৳${p.price.toLocaleString('bn-BD')}</p>`;
                    favListEl.appendChild(card);
                });
            }
            setLanguage(localStorage.getItem('language') || 'bn');
        }
        
        function renderOrders(orders) {
            const ordersListEl = document.getElementById('orders-list');
            if (!ordersListEl) return;
            ordersListEl.innerHTML = '';
            if (orders.length === 0) {
                ordersListEl.innerHTML = `<p data-lang-key="orders_none"></p>`;
                setLanguage(localStorage.getItem('language') || 'bn');
                return;
            }

            orders.sort((a, b) => b.createdAt.toMillis() - a.createdAt.toMillis());

            orders.forEach(order => {
                const orderDate = order.createdAt ? order.createdAt.toDate().toLocaleString('bn-BD', { dateStyle: 'long', timeStyle: 'short' }) : 'N/A';
                
                const itemsDetails = order.items.map(item => {
                    const product = state.products.find(p => p.id === item.productId);
                    return product ? `<li>${product.name} (x${item.quantity})</li>` : `<li>Product ID: ${item.productId}</li>`;
                }).join('');

                const statusClass = order.status === 'pending' ? 'bg-yellow-500' : (order.status === 'completed' ? 'bg-green-500 text-white' : 'bg-red-500 text-white');
                const statusText = order.status || 'N/A';

                const orderEl = document.createElement('div');
                orderEl.className = 'border-b border-gray-700 py-4 last:border-b-0';
                orderEl.innerHTML = `
                    <div class="flex justify-between items-start flex-wrap">
                        <div>
                            <p class="font-bold text-base">অর্ডার আইডি:</p>
                            <p class="text-xs mb-2">${order.id}</p>
                            <p class="text-sm">তারিখ: ${orderDate}</p>
                        </div>
                        <div class="text-right mt-2 sm:mt-0">
                            <p class="font-bold text-lg text-yellow-400">৳${order.totalAmount.toLocaleString('bn-BD')}</p>
                            <span class="text-xs font-semibold px-2 py-1 rounded-full ${statusClass}">${statusText}</span>
                        </div>
                    </div>
                    <div class="mt-3">
                        <p class="font-semibold text-sm">ক্রয়কৃত পণ্য:</p>
                        <ul class="list-disc list-inside text-sm pl-2">
                            ${itemsDetails}
                        </ul>
                    </div>
                `;
                ordersListEl.appendChild(orderEl);
            });
        }
        
        function renderBanners() {
            const sliderContainer = document.getElementById('slider');
            // Clear only slides, not nav buttons
            const existingSlides = sliderContainer.querySelectorAll('.slide');
            existingSlides.forEach(slide => slide.remove());

            if (state.banners.length === 0) {
                sliderContainer.insertAdjacentHTML('afterbegin', `
                    <div class="slide active">
                        <img src="https://placehold.co/1920x1080/111827/FBBF24?text=Pochonder+Shop" alt="Welcome">
                        <div class="slide-content">
                            <h2 class="text-3xl font-bold">পছন্দের শপে স্বাগতম</h2>
                            <p>আপনার সব ডিজিটাল পণ্যের নির্ভরযোগ্য সমাধান।</p>
                        </div>
                    </div>
                `);
            } else {
                [...state.banners].reverse().forEach((banner, index) => {
                    const slideHTML = `
                        <div class="slide ${index === 0 ? 'active' : ''}">
                            <img src="${banner.image}" alt="${banner.title}" onerror="this.onerror=null;this.src='https://placehold.co/1920x1080/1e293b/ffffff?text=Image+Error';">
                            <div class="slide-content">
                                <h2 class="text-3xl font-bold">${banner.title}</h2>
                                <p>${banner.description}</p>
                            </div>
                        </div>
                    `;
                    // Insert before nav buttons
                    sliderContainer.insertBefore(document.createRange().createContextualFragment(slideHTML), sliderContainer.querySelector('.slider-nav'));
                });
            }
            initializeSlider();
        }
        
        function initializeSlider() {
            let currentSlide = 0;
            const slides = document.querySelectorAll('#slider .slide');
            const totalSlides = slides.length;

            if (window.sliderInterval) clearInterval(window.sliderInterval);
            
            if (totalSlides <= 1) return;

            const showSlide = i => slides.forEach((s, idx) => s.classList.toggle('active', i === idx));
            const next = () => { currentSlide = (currentSlide + 1) % totalSlides; showSlide(currentSlide); };
            
            window.sliderInterval = setInterval(next, 5000);
        }

        function renderReviews(reviews) {
            const container = document.getElementById('reviews-list');
            container.innerHTML = '';
            if(reviews.length === 0) {
                container.innerHTML = `<p data-lang-key="reviews_none"></p>`;
                setLanguage(localStorage.getItem('language') || 'bn');
                return;
            }
            reviews.sort((a,b) => b.createdAt.toMillis() - a.createdAt.toMillis()).forEach(review => {
                const date = review.createdAt ? review.createdAt.toDate().toLocaleDateString('bn-BD') : '';
                let starsHTML = '';
                for(let i=1; i<=5; i++) {
                    starsHTML += `<svg class="w-4 h-4 ${i <= review.rating ? 'text-yellow-400' : 'text-gray-500'}" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg>`;
                }
                const reviewEl = document.createElement('div');
                reviewEl.className = 'border-b border-gray-800 pb-3';
                reviewEl.innerHTML = `
                    <div class="flex items-center mb-1">
                        <p class="font-semibold mr-2">${review.userName || 'Anonymous'}</p>
                        <div class="flex">${starsHTML}</div>
                    </div>
                    <p class="text-sm text-gray-400">${review.comment}</p>
                    <p class="text-xs text-gray-500 text-right">${date}</p>
                `;
                container.appendChild(reviewEl);
            });
        }

        function renderReviewForm() {
            const container = document.getElementById('review-form-container');
            if (state.user && !state.user.isAnonymous) {
                 container.innerHTML = `
                    <h5 class="text-lg font-semibold mb-3" data-lang-key="review_form_title"></h5>
                    <form id="review-form">
                        <div class="star-rating flex items-center mb-2" data-rating="0">
                            ${[1,2,3,4,5].map(i => `<span class="star" data-action="setRating" data-value="${i}"><svg class="w-6 h-6 pointer-events-none" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" /></svg></span>`).join('')}
                        </div>
                        <textarea id="review-comment" class="w-full bg-gray-800 p-3 rounded-md" rows="3" data-lang-key="review_form_placeholder" required></textarea>
                        <button type="submit" class="mt-2 bg-yellow-500 hover:bg-yellow-600 font-bold py-2 px-4 rounded-lg text-sm" data-lang-key="review_form_submit"></button>
                    </form>`;
            } else {
                container.innerHTML = '';
            }
            setLanguage(localStorage.getItem('language') || 'bn');
        }

        // --- CUSTOMER-FACING DATA LOGIC ---
        function listenForProductUpdates() {
            state.unsubscribers.products();
            state.unsubscribers.products = onSnapshot(collection(db, `artifacts/${appId}/public/data/products`), (snapshot) => {
                state.products = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                const newCategories = ['All', ...new Set(state.products.map(p => p.category))];
                const categoryContainer = document.getElementById('category-filters');
                categoryContainer.innerHTML = newCategories.map(c => `<button class="category-btn px-4 py-2 rounded-full text-sm font-semibold transition ${c === state.currentCategory ? 'active' : ''}" data-action="setCategory" data-category="${c}">${c}</button>`).join('');
                renderProducts();
                if (!document.getElementById('dashboard').classList.contains('hidden')) {
                    renderFavoritesInDashboard();
                }
            }, (error) => {
                console.error("Error listening to product updates:", error);
                showNotification("প্রোডাক্টের তালিকা আপডেট করা সম্ভব হয়নি।", "error");
            });
        }
        
        function listenForBannerUpdates() {
            state.unsubscribers.banners();
            state.unsubscribers.banners = onSnapshot(collection(db, `artifacts/${appId}/public/data/banners`), (snapshot) => {
                state.banners = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                renderBanners();
            }, (error) => {
                console.error("Error fetching banners:", error);
                renderBanners(); // Render with default banner on error
            });
        }
        
        function listenForSiteSettings() {
            state.unsubscribers.siteSettings();
            state.unsubscribers.siteSettings = onSnapshot(doc(db, `artifacts/${appId}/public/data/site_settings/details`), (docSnap) => {
                if (docSnap.exists()) {
                    state.siteSettings = docSnap.data();
                    document.getElementById('gateway-number').innerText = state.siteSettings.gatewayNumber || 'N/A';
                    document.getElementById('gateway-name').innerText = state.siteSettings.gatewayName || 'N/A';
                } else {
                    state.siteSettings = null;
                    document.getElementById('gateway-number').innerText = '01XXXXXXXXX';
                    document.getElementById('gateway-name').innerText = 'Not Set';
                }
            }, (error) => {
                console.error("Error fetching site settings:", error);
            });
        }
        
        function listenForReviews(productId) {
            state.unsubscribers.reviews();
            state.unsubscribers.reviews = onSnapshot(collection(db, `artifacts/${appId}/public/data/products/${productId}/reviews`), (snapshot) => {
                const reviews = snapshot.docs.map(doc => ({id: doc.id, ...doc.data()}));
                renderReviews(reviews);
            });
        }
        
        async function fetchUserProfile() {
            if (!state.user || state.user.isAnonymous) {
                state.userProfile = null; return;
            }
            const docRef = doc(db, `artifacts/${appId}/users/${state.user.uid}/profile/details`);
            const docSnap = await getDoc(docRef);
            if (docSnap.exists()) {
                state.userProfile = docSnap.data();
                document.getElementById('profile-full-name').innerText = state.userProfile.fullName || '';
                document.getElementById('profile-email').innerText = state.userProfile.email || '';
                document.getElementById('profile-mobile').innerText = state.userProfile.mobile || '';
                document.getElementById('settings-address').value = state.userProfile.address || '';
                document.getElementById('settings-house').value = state.userProfile.houseNumber || '';
                document.getElementById('settings-zip').value = state.userProfile.zipCode || '';
                document.getElementById('payout-method').value = state.userProfile.payoutMethod || 'bKash';
                document.getElementById('payout-number').value = state.userProfile.payoutNumber || '';
            } else {
                state.userProfile = null;
            }
        }

        async function addToCart(productId) {
            try {
                const cartCol = collection(db, `artifacts/${appId}/users/${state.user.uid}/cart`);
                await addDoc(cartCol, { productId, quantity: 1, addedAt: serverTimestamp() });
                showNotification('পণ্যটি কার্টে যোগ করা হয়েছে।');
            } catch (e) { showNotification('কার্টে যোগ করতে সমস্যা হয়েছে।', 'error'); }
        }

        async function removeFromCart(cartId) {
             if (!cartId) return;
             try {
                const docRef = doc(db, `artifacts/${appId}/users/${state.user.uid}/cart`, cartId);
                await deleteDoc(docRef);
                state.selectedCartItemIds.delete(cartId);
                showNotification('কার্ট থেকে পণ্য মুছে ফেলা হয়েছে।');
             } catch (err) {
                 showNotification('পণ্যটি মুছতে সমস্যা হয়েছে।', 'error');
             }
        }

        async function toggleFavorite(productId) {
            try {
                const favCol = collection(db, `artifacts/${appId}/users/${state.user.uid}/favorites`);
                const q = query(favCol, where("productId", "==", productId));
                const snapshot = await getDocs(q);
                if (snapshot.empty) {
                    await addDoc(favCol, { productId, addedAt: serverTimestamp() });
                    showNotification('পণ্যটি ফেভারিটে যোগ করা হয়েছে।');
                } else {
                    await deleteDoc(snapshot.docs[0].ref);
                    showNotification('পণ্যটি ফেভারিট থেকে মুছে ফেলা হয়েছে।');
                }
            } catch (e) { console.error(e); showNotification('ফেভারিট পরিবর্তন করতে সমস্যা হয়েছে।', 'error'); }
        }
        
        function buyNow(productId) {
            const product = state.products.find(p => p.id === productId);
            if (product) {
                const itemsToCheckout = [{ productId: product.id, quantity: 1 }];
                startCheckoutProcess(itemsToCheckout);
            } else {
                showNotification('প্রোডাক্ট খুঁজে পাওয়া যায়নি।', 'error');
            }
        }
        
        function startCheckoutProcess(items) {
            if (!items || items.length === 0) return;
            if (!state.siteSettings || !state.siteSettings.gatewayNumber) {
                showNotification('সাইটের পেমেন্ট পদ্ধতি এখনো সেট করা হয়নি।', 'error');
                return;
            }

            const totalAmount = items.reduce((acc, item) => {
                const product = state.products.find(p => p.id === item.productId);
                return acc + (product ? product.price * item.quantity : 0);
            }, 0);

            if (totalAmount <= 0) return;
            
            state.checkoutItems = items;
            document.getElementById('cart-modal').classList.remove('active');
            document.getElementById('product-details-modal').classList.remove('active');
            
            document.getElementById('payment-amount').innerText = `৳${totalAmount.toLocaleString('bn-BD')}`;
            document.getElementById('payment-modal').classList.add('active');
        }

        function showDashboardPage(targetPageId) {
            document.getElementById('main-content').classList.add('hidden');
            const dashboard = document.getElementById('dashboard');
            dashboard.classList.remove('hidden');
            
            handleAction('switchDashboardTab', { target: targetPageId });
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        async function openProductDetailsModal(productId) {
            const product = state.products.find(p => p.id === productId);
            if (!product) return;
            state.currentOpenProduct = product;

            document.getElementById('details-img').src = product.image;
            document.getElementById('details-name').innerText = product.name;
            document.getElementById('details-price').innerText = `৳${product.price.toLocaleString('bn-BD')}`;
            document.getElementById('details-category').innerText = product.category;
            document.getElementById('details-desc').innerText = product.description || 'No description available.';

            listenForReviews(productId);
            renderReviewForm();

            document.getElementById('product-details-modal').classList.add('active');
            
            try {
                const productRef = doc(db, `artifacts/${appId}/public/data/products`, productId);
                await updateDoc(productRef, { views: increment(1) });
            } catch (err) {
                console.error("Error incrementing product view:", err);
            }
        }

        async function handleReviewSubmit(e) {
            e.preventDefault();
            const rating = e.target.querySelector('.star-rating').dataset.rating;
            const comment = e.target.querySelector('#review-comment').value;

            if (rating === '0' || !comment) {
                showNotification('অনুগ্রহ করে রেটিং এবং মন্তব্য দিন।', 'error'); return;
            }

            try {
                const reviewData = {
                    userId: state.user.uid,
                    userName: state.userProfile?.fullName || state.user.email,
                    rating: parseInt(rating),
                    comment,
                    createdAt: serverTimestamp()
                };
                const reviewsCol = collection(db, `artifacts/${appId}/public/data/products/${state.currentOpenProduct.id}/reviews`);
                await addDoc(reviewsCol, reviewData);
                showNotification('আপনার রিভিউ সফলভাবে জমা হয়েছে।');
                e.target.reset();
                document.querySelector('#review-form .star-rating').dataset.rating = 0;
                document.querySelectorAll('#review-form .star').forEach(s => s.classList.remove('selected'));
            } catch (err) {
                showNotification('রিভিউ জমা দিতে সমস্যা হয়েছে।', 'error');
            }
        }

        // --- ADMIN PANEL FUNCTIONS ---
        
        function showAdminPage(viewId) {
             // Unsubscribe from previous listener
            Object.values(state.unsubscribers).forEach(unsub => unsub && unsub());

            document.querySelectorAll('.admin-view').forEach(view => view.classList.add('hidden'));
            document.getElementById(`${viewId}-view`).classList.remove('hidden');
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.toggle('active', item.dataset.target === viewId);
            });
            switch (viewId) {
                case 'dashboard': loadDashboardData(); break;
                case 'users': loadAdminUsers(); break;
                case 'products': loadAdminProducts(); break;
                case 'seller-products': loadSellerProducts(); break;
                case 'orders': loadAdminOrders(); break;
                case 'promotions': loadPromotions(); break;
                case 'content': loadContent(); break;
                case 'site-settings': loadAdminSiteSettings(); break;
            }
        }
        
        async function loadDashboardData() {
            const usersSnapshot = await getDocs(collection(db, `artifacts/${appId}/users`));
            document.getElementById('total-users').textContent = usersSnapshot.size;
            
            const ordersQuery = query(collection(db, `artifacts/${appId}/public/data/orders`));
            const ordersSnapshot = await getDocs(ordersQuery);
            document.getElementById('total-orders').textContent = ordersSnapshot.size;

            let dailyRevenue = 0;
            let monthlyRevenue = 0;
            const now = new Date();
            const todayStart = new Date(now.getFullYear(), now.getMonth(), now.getDate());
            const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);

            ordersSnapshot.forEach(doc => {
                const order = doc.data();
                if (order.createdAt) { 
                    const orderDate = order.createdAt.toDate();
                    if (order.status === 'completed') {
                        if (orderDate >= todayStart) dailyRevenue += order.totalAmount;
                        if (orderDate >= monthStart) monthlyRevenue += order.totalAmount;
                    }
                }
            });
            document.getElementById('daily-revenue').textContent = `৳${dailyRevenue.toLocaleString('bn-BD')}`;
            document.getElementById('monthly-revenue').textContent = `৳${monthlyRevenue.toLocaleString('bn-BD')}`;

            const statsRef = doc(db, `artifacts/${appId}/public/data/stats/visits`);
            const statsSnap = await getDoc(statsRef);
            document.getElementById('site-visits').textContent = statsSnap.exists() ? statsSnap.data().count : 0;
        }

        function loadAdminUsers() {
            const tableBody = document.getElementById('users-table-body');
            const q = query(collection(db, `artifacts/${appId}/users`));
            state.unsubscribers.adminUsers();
            state.unsubscribers.adminUsers = onSnapshot(q, async (snapshot) => {
                let html = '';
                for (const userDoc of snapshot.docs) {
                    const profileSnap = await getDoc(doc(db, `artifacts/${appId}/users/${userDoc.id}/profile/details`));
                    if (profileSnap.exists()) {
                        const user = profileSnap.data();
                        const isBlocked = user.status === 'blocked';
                        html += `
                            <tr class="border-b border-gray-700 hover:bg-gray-900">
                                <td class="p-4">${user.fullName || 'N/A'}</td>
                                <td class="p-4">${user.email}</td>
                                <td class="p-4"><span class="px-2 py-1 rounded-full text-xs ${isBlocked ? 'bg-red-500 text-white' : 'bg-green-500 text-black'}">${isBlocked ? 'Blocked' : 'Active'}</span></td>
                                <td class="p-4 space-x-2">
                                    <button data-action="view-user" data-uid="${userDoc.id}" class="text-blue-400 hover:underline">বিস্তারিত</button>
                                    <button data-action="toggle-block" data-uid="${userDoc.id}" data-status="${isBlocked ? 'active' : 'blocked'}" class="${isBlocked ? 'text-green-400' : 'text-red-400'} hover:underline">${isBlocked ? 'Unblock' : 'Block'}</button>
                                </td>
                            </tr>`;
                    }
                }
                tableBody.innerHTML = html || '<tr><td colspan="4" class="p-4 text-center">কোনো ব্যবহারকারী নেই।</td></tr>';
            });
        }
        
        function loadAdminProducts() {
            const tableBody = document.getElementById('products-table-body');
            const q = query(collection(db, `artifacts/${appId}/public/data/products`));
            state.unsubscribers.adminProducts();
            state.unsubscribers.adminProducts = onSnapshot(q, (snapshot) => {
                let html = '';
                snapshot.forEach(doc => {
                    const product = doc.data();
                    html += `
                        <tr class="border-b border-gray-700 hover:bg-gray-900">
                            <td class="p-4">${product.name}</td>
                            <td class="p-4">${product.category}</td>
                            <td class="p-4">৳${product.price}</td>
                            <td class="p-4 space-x-2">
                                <button data-action="edit-product" data-id="${doc.id}" class="text-blue-400 hover:underline">সম্পাদনা</button>
                                <button data-action="delete-product" data-id="${doc.id}" class="text-red-400 hover:underline">ডিলিট</button>
                            </td>
                        </tr>`;
                });
                tableBody.innerHTML = html || '<tr><td colspan="4" class="p-4 text-center">কোনো পণ্য নেই।</td></tr>';
            });
        }
        
        function loadSellerProducts() {
            const tableBody = document.getElementById('seller-products-table-body');
            const q = query(collection(db, `artifacts/${appId}/public/data/sellerProducts`));
            state.unsubscribers.adminSellerProducts();
            state.unsubscribers.adminSellerProducts = onSnapshot(q, async (snapshot) => {
                let html = '';
                for (const docRef of snapshot.docs) {
                     const product = docRef.data();
                     if (!product.sellerId) continue;
                     const userDoc = await getDoc(doc(db, `artifacts/${appId}/users/${product.sellerId}/profile/details`));
                     const sellerName = userDoc.exists() ? userDoc.data().fullName : 'Unknown';
                     html += `
                         <tr class="border-b border-gray-700 hover:bg-gray-900">
                              <td class="p-4">${product.name}</td>
                              <td class="p-4">${sellerName}</td>
                              <td class="p-4">৳${product.price}</td>
                              <td class="p-4">${product.status}</td>
                              <td class="p-4 space-x-2">
                                   ${product.status === 'pending' ? `<button data-action="approve-product" data-id="${docRef.id}" class="text-green-400 hover:underline">Approve</button> <button data-action="reject-product" data-id="${docRef.id}" class="text-red-400 hover:underline">Reject</button>` : ''}
                              </td>
                         </tr>`;
                }
                tableBody.innerHTML = html || '<tr><td colspan="5" class="p-4 text-center">রিভিউয়ের জন্য কোনো পণ্য নেই।</td></tr>';
            });
        }
        
        function loadAdminOrders() {
            const tableBody = document.getElementById('orders-table-body');
            const q = query(collection(db, `artifacts/${appId}/public/data/orders`));
            state.unsubscribers.adminOrders();
            state.unsubscribers.adminOrders = onSnapshot(q, (snapshot) => {
                let html = '';
                snapshot.forEach(doc => {
                    const order = doc.data();
                    html += `
                        <tr class="border-b border-gray-700 hover:bg-gray-900">
                            <td class="p-4 text-xs">${doc.id}</td>
                            <td class="p-4 text-xs">${order.userId}</td>
                            <td class="p-4">৳${order.totalAmount}</td>
                            <td class="p-4">${order.paymentTrxId}</td>
                            <td class="p-4">
                                 <select data-action="updateOrderStatus" data-order-id="${doc.id}" class="status-select bg-gray-700 rounded p-1">
                                      <option value="pending" ${order.status === 'pending' ? 'selected' : ''}>Pending</option>
                                      <option value="completed" ${order.status === 'completed' ? 'selected' : ''}>Completed</option>
                                      <option value="cancelled" ${order.status === 'cancelled' ? 'selected' : ''}>Cancelled</option>
                                 </select>
                            </td>
                        </tr>`;
                });
                tableBody.innerHTML = html || '<tr><td colspan="5" class="p-4 text-center">কোনো অর্ডার নেই।</td></tr>';
            });
        }

        function loadPromotions() {
            const tableBody = document.getElementById('coupons-table-body');
            const q = query(collection(db, `artifacts/${appId}/public/data/coupons`));
            state.unsubscribers.adminPromotions();
            state.unsubscribers.adminPromotions = onSnapshot(q, (snapshot) => {
                let html = '';
                snapshot.forEach(doc => {
                    const coupon = doc.data();
                    html += `
                        <tr class="border-b border-gray-700 hover:bg-gray-900">
                            <td class="p-4">${coupon.code}</td>
                            <td class="p-4">${coupon.discount}%</td>
                            <td class="p-4"><button data-action="delete-coupon" data-id="${doc.id}" class="text-red-400 hover:underline">ডিলিট</button></td>
                        </tr>`;
                });
                tableBody.innerHTML = html || '<tr><td colspan="3" class="p-4 text-center">কোনো কুপন নেই।</td></tr>';
            });
        }

        function loadContent() {
            const tableBody = document.getElementById('banners-table-body');
            const q = query(collection(db, `artifacts/${appId}/public/data/banners`));
            state.unsubscribers.adminContent();
            state.unsubscribers.adminContent = onSnapshot(q, (snapshot) => {
                let html = '';
                snapshot.forEach(doc => {
                    const banner = doc.data();
                    html += `
                        <tr class="border-b border-gray-700 hover:bg-gray-900">
                            <td class="p-4">${banner.title}</td>
                            <td class="p-4"><img src="${banner.image}" class="h-10 w-20 object-cover rounded"></td>
                            <td class="p-4"><button data-action="delete-banner" data-id="${doc.id}" class="text-red-400 hover:underline">ডিলিট</button></td>
                        </tr>`;
                });
                tableBody.innerHTML = html || '<tr><td colspan="3" class="p-4 text-center">কোনো ব্যানার নেই।</td></tr>';
            });
        }
        
        function loadAdminSiteSettings() {
            const settingsRef = doc(db, `artifacts/${appId}/public/data/site_settings/details`);
            state.unsubscribers.adminSiteSettings();
            state.unsubscribers.adminSiteSettings = onSnapshot(settingsRef, (docSnap) => {
                if (docSnap.exists()) {
                    const settings = docSnap.data();
                    document.getElementById('site-payment-gateway').value = settings.gatewayName || '';
                    document.getElementById('site-payment-number').value = settings.gatewayNumber || '';
                } else {
                    document.getElementById('site-payment-gateway').value = '';
                    document.getElementById('site-payment-number').value = '';
                }
            });
        }
        
        function listenForPendingReviews() {
            const q = query(collection(db, `artifacts/${appId}/public/data/sellerProducts`), where("status", "==", "pending"));
            state.unsubscribers.adminPendingReviews();
            state.unsubscribers.adminPendingReviews = onSnapshot(q, (snapshot) => {
                document.getElementById('review-count').textContent = snapshot.size;
            });
        }

        // --- Event Delegation & Action Router ---
        function handleAction(action, data = {}) {
            const { productId, modalId, lang, category, target, cartItemId, cartId, value, orderId, uid, status, id } = data;

            if (!state.user || state.user.isAnonymous) {
                const protectedActions = ['addToCart', 'buyNow', 'toggleFavorite', 'showDashboard', 'showSellProduct', 'showFavorites'];
                if (protectedActions.includes(action)) {
                     showNotification('এই ফিচারটি ব্যবহার করতে লগইন করুন।', 'error');
                     document.getElementById('auth-modal').classList.add('active');
                     return;
                }
            }
            
            switch (action) {
                // UI Actions
                case 'toggleTheme': applyTheme(localStorage.getItem('theme') === 'dark' ? 'light' : 'dark'); break;
                case 'setLang': setLanguage(lang); break;
                case 'openModal': document.getElementById(modalId).classList.add('active'); break;
                case 'closeModal': document.getElementById(modalId).classList.remove('active');
                    if (modalId === 'product-details-modal') { state.unsubscribers.reviews(); state.currentOpenProduct = null; }
                    if (modalId === 'payment-modal') state.checkoutItems = [];
                    break;
                case 'showLoginView':
                    document.getElementById('login-view').classList.remove('hidden');
                    document.getElementById('register-view').classList.add('hidden');
                    break;
                case 'showRegisterView':
                    document.getElementById('login-view').classList.add('hidden');
                    document.getElementById('register-view').classList.remove('hidden');
                    break;
                case 'authAction':
                    if (state.user && !state.user.isAnonymous) { signOut(auth); }
                    else { document.getElementById('auth-modal').classList.add('active'); }
                    break;

                // Navigation
                case 'showHome': showCustomerView(); break;
                case 'showDashboard': showDashboardPage('my-orders'); break;
                case 'showSellProduct': showDashboardPage('upload-product'); break;
                case 'showFavorites': showDashboardPage('my-favorites'); break;
                case 'switchDashboardTab':
                    document.querySelectorAll('.dashboard-nav-item').forEach(el => el.classList.remove('active'));
                    document.querySelector(`[data-target="${target}"]`).classList.add('active');
                    document.querySelectorAll('.dashboard-content').forEach(el => el.classList.add('hidden'));
                    document.getElementById(target).classList.remove('hidden');
                    break;

                // Product & Cart Actions (Customer)
                case 'setCategory': state.currentCategory = category; renderProducts(); break;
                case 'openDetails': openProductDetailsModal(productId); break;
                case 'addToCart': addToCart(productId || state.currentOpenProduct.id); break;
                case 'buyNow': buyNow(productId || state.currentOpenProduct.id); break;
                case 'toggleFavorite': toggleFavorite(productId); break;
                case 'removeFromCart': removeFromCart(cartId); break;
                case 'toggleCartItemSelection':
                    const checkbox = document.querySelector(`[data-cart-item-id="${cartItemId}"]`);
                    if (checkbox.checked) state.selectedCartItemIds.add(cartItemId);
                    else state.selectedCartItemIds.delete(cartItemId);
                    renderCart();
                    break;
                case 'setRating':
                    const ratingContainer = document.querySelector('#review-form .star-rating');
                    ratingContainer.dataset.rating = value;
                    ratingContainer.querySelectorAll('.star').forEach(s => s.classList.toggle('selected', s.dataset.value <= value));
                    break;

                // Admin Actions
                case 'toggle-block': updateDoc(doc(db, `artifacts/${appId}/users/${uid}/profile/details`), { status }); break;
                case 'view-user': (async () => {
                    const userSnap = await getDoc(doc(db, `artifacts/${appId}/users/${uid}/profile/details`));
                    const content = document.getElementById('user-details-content');
                    content.innerHTML = userSnap.exists() ? `<p><strong>নাম:</strong> ${userSnap.data().fullName}</p>...` : 'User not found.';
                    document.getElementById('user-details-modal').classList.add('active');
                })(); break;
                case 'edit-product': (async () => {
                     const productSnap = await getDoc(doc(db, `artifacts/${appId}/public/data/products`, id));
                     if(productSnap.exists()) {
                         const p = productSnap.data();
                         document.getElementById('product-id').value = id;
                         document.getElementById('product-name').value = p.name;
                         // ... fill rest of form ...
                         document.getElementById('product-modal').classList.add('active');
                     }
                })(); break;
                case 'delete-product': if(confirm('Are you sure?')) deleteDoc(doc(db, `artifacts/${appId}/public/data/products`, id)); break;
                case 'approve-product': (async () => {
                    const productRef = doc(db, `artifacts/${appId}/public/data/sellerProducts`, id);
                    const productSnap = await getDoc(productRef);
                    if(productSnap.exists()) {
                        const data = productSnap.data();
                        delete data.status;
                        await addDoc(collection(db, `artifacts/${appId}/public/data/products`), data);
                        await updateDoc(productRef, {status: 'approved'});
                    }
                })(); break;
                case 'reject-product': updateDoc(doc(db, `artifacts/${appId}/public/data/sellerProducts`, id), { status: 'rejected' }); break;
                case 'delete-coupon': if(confirm('Are you sure?')) deleteDoc(doc(db, `artifacts/${appId}/public/data/coupons`, id)); break;
                case 'delete-banner': if(confirm('Are you sure?')) deleteDoc(doc(db, `artifacts/${appId}/public/data/banners`, id)); break;
                 case 'updateOrderStatus':
                    const selectEl = document.querySelector(`[data-order-id="${orderId}"]`);
                    updateOrderStatus(orderId, selectEl.value);
                    break;
                case 'prevSlide':
                case 'nextSlide':
                    const slides = document.querySelectorAll('#slider .slide');
                    if (slides.length <=1) return;
                    let current = [...slides].findIndex(s => s.classList.contains('active'));
                    slides[current].classList.remove('active');
                    if (action === 'nextSlide') current = (current + 1) % slides.length;
                    else current = (current - 1 + slides.length) % slides.length;
                    slides[current].classList.add('active');
                    initializeSlider();
                    break;
            }
        }
        
        function init() {
            try {
                // Initialize Firebase
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                // Setup Initial UI
                applyTheme(localStorage.getItem('theme') || 'dark');
                setLanguage(localStorage.getItem('language') || 'bn');
                
                // --- GLOBAL EVENT LISTENERS ---
                document.body.addEventListener('click', e => {
                    const actionTarget = e.target.closest('[data-action]');
                    if (actionTarget) {
                        e.preventDefault();
                        const productCard = actionTarget.closest('[data-product-id]');
                        const combinedData = {
                            ...actionTarget.dataset,
                            ...(productCard ? { productId: productCard.dataset.productId } : {})
                        };
                        handleAction(actionTarget.dataset.action, combinedData);
                    }
                });
                
                document.getElementById('sidebar-nav').addEventListener('click', (e) => {
                     if (e.target.tagName === 'BUTTON') {
                         showAdminPage(e.target.dataset.target);
                     }
                 });

                // Form submissions and other specific listeners
                document.getElementById('search-bar').addEventListener('input', e => {
                    state.searchTerm = e.target.value.toLowerCase();
                    renderProducts();
                });

                // Login for BOTH customer and admin
                document.getElementById('customer-login-form').addEventListener('submit', async e => {
                    e.preventDefault();
                    try {
                        await signInWithEmailAndPassword(auth, e.target['login-email'].value, e.target['login-password'].value);
                         document.getElementById('auth-modal').classList.remove('active');
                    } catch (err) { showNotification('ইমেইল বা পাসওয়ার্ড ভুল।', 'error'); }
                });

                document.getElementById('register-form').addEventListener('submit', async e => {
                    e.preventDefault();
                    const name = e.target['register-name'].value;
                    const mobile = e.target['register-mobile'].value;
                    const email = e.target['register-email'].value;
                    const password = e.target['register-password'].value;
                    if (password !== e.target['register-confirm-password'].value) { showNotification('পাসওয়ার্ড মেলেনি।', 'error'); return; }
                    if (!e.target['register-terms'].checked) { showNotification('শর্তাবলীতে সম্মত হতে হবে।', 'error'); return; }
                    try {
                        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                        const user = userCredential.user;
                        const profileRef = doc(db, `artifacts/${appId}/users/${user.uid}/profile/details`);
                        await setDoc(profileRef, { fullName: name, mobile: mobile, email: email, createdAt: serverTimestamp() });
                        document.getElementById('auth-modal').classList.remove('active');
                        showNotification('অ্যাকাউন্ট সফলভাবে তৈরি হয়েছে।');
                    } catch (err) { 
                        if (err.code === 'auth/email-already-in-use') showNotification('এই ইমেইলটি ஏற்கனவே ব্যবহৃত হয়েছে।', 'error');
                        else if (err.code === 'auth/weak-password') showNotification('পাসওয়ার্ডটি দুর্বল। কমপক্ষে ৬টি অক্ষর ব্যবহার করুন।', 'error');
                        else showNotification('রেজিস্ট্রেশন ব্যর্থ হয়েছে।', 'error');
                    }
                });
                
                document.getElementById('upload-form').addEventListener('submit', async e => {
                    e.preventDefault();
                    if(!state.user || state.user.isAnonymous) return;
                    try {
                        await addDoc(collection(db, `artifacts/${appId}/public/data/products`), {
                            name: document.getElementById('upload-name').value,
                            description: document.getElementById('upload-desc').value,
                            price: parseFloat(document.getElementById('upload-price').value),
                            category: document.getElementById('upload-category').value,
                            image: document.getElementById('upload-image').value,
                            sellerId: state.user.uid,
                            views: 0,
                            createdAt: serverTimestamp()
                        });
                        showNotification('আপনার পণ্য সফলভাবে আপলোড হয়েছে।');
                        e.target.reset();
                        showDashboardPage('my-orders');
                    } catch (err) { showNotification('পণ্য আপলোড করতে সমস্যা হয়েছে।', 'error'); }
                });

                document.getElementById('settings-form').addEventListener('submit', async e => {
                    e.preventDefault();
                    if(!state.user || state.user.isAnonymous) return;
                    try {
                        const docRef = doc(db, `artifacts/${appId}/users/${state.user.uid}/profile/details`);
                        await setDoc(docRef, {
                            address: document.getElementById('settings-address').value,
                            houseNumber: document.getElementById('settings-house').value,
                            zipCode: document.getElementById('settings-zip').value,
                            payoutMethod: document.getElementById('payout-method').value,
                            payoutNumber: document.getElementById('payout-number').value,
                        }, { merge: true }); 
                        showNotification('আপনার তথ্য সেভ করা হয়েছে।');
                    } catch (err) { showNotification('তথ্য সেভ করা যায়নি।', 'error');}
                });
                
                document.getElementById('admin-site-settings-form').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const gatewayName = document.getElementById('site-payment-gateway').value;
                    const gatewayNumber = document.getElementById('site-payment-number').value;
                    try {
                        await setDoc(doc(db, `artifacts/${appId}/public/data/site_settings/details`), { gatewayName, gatewayNumber }, { merge: true });
                        showNotification('সাইট সেটিংস সফলভাবে সেভ হয়েছে।', 'success');
                    } catch (err) {
                        showNotification('সেটিংস সেভ করতে সমস্যা হয়েছে।', 'error');
                    }
                });

                document.getElementById('payment-form').addEventListener('submit', async e => {
                    e.preventDefault();
                    if (!state.checkoutItems || state.checkoutItems.length === 0) return;
                    const totalAmount = state.checkoutItems.reduce((acc, item) => {
                        const product = state.products.find(p => p.id === item.productId);
                        return acc + (product ? product.price * item.quantity : 0);
                    }, 0);
                    const orderDetails = {
                        items: state.checkoutItems.map(item => ({productId: item.productId, quantity: item.quantity})),
                        totalAmount,
                        paymentPhone: document.getElementById('payment-phone').value,
                        paymentTrxId: document.getElementById('payment-trxid').value,
                        status: 'pending',
                        createdAt: serverTimestamp(),
                        userId: state.user.uid
                    };
                    try {
                        await addDoc(collection(db, `artifacts/${appId}/public/data/orders`), orderDetails);
                        const purchasedCartItemIds = new Set(state.checkoutItems.filter(item => item.id).map(item => item.id));
                        if (purchasedCartItemIds.size > 0) {
                            const batch = writeBatch(db);
                            purchasedCartItemIds.forEach(cartId => batch.delete(doc(db, `artifacts/${appId}/users/${state.user.uid}/cart`, cartId)));
                            await batch.commit();
                        }
                        state.checkoutItems = [];
                        state.selectedCartItemIds.clear();
                        document.getElementById('payment-modal').classList.remove('active');
                        showNotification('আপনার অর্ডারটি গ্রহণ করা হয়েছে।');
                        e.target.reset();
                        showDashboardPage('my-orders');
                    } catch (err) {
                        showNotification('অর্ডার কনফার্ম করা

